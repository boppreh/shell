<html>
<head>
	<title>Title</title>
	<meta charset="utf-8">
	<style>
body {
	font: 12px courier,sans-serif;
}

input {
	font: inherit;
}

.input-part {
	margin-left: 5px;
	padding: 3px;
	background: #EEE;
}
.input-part::before .input-part::after {
	content: '  ';
}
.result {
	padding: 10px;
	margin-bottom: 10px;
	background: #EEE;
}
	</style>
	<script>
function run(parts, responseDiv) {
    var formData = new FormData();
    formData.append('data', JSON.stringify(parts));
    var request = new XMLHttpRequest();
    request.open('POST', '/run', true);
    request.onreadystatechange = function() {
	    if (request.readyState < 4) {
	        return;
	    }

	    responseDiv.innerText = request.responseText;
	};
    request.send(formData);
}
var allBlocks = [];
function newBlock() {
	var n = allBlocks.length + 1;

	var block = document.createElement('div');

	if (n !== undefined) {
		block.id = 'block' + n;
		var number = document.createElement('span');
		number.innerText = '#' + n;
		number.classList.add('block-number');
		block.appendChild(number);
	}

	var inSpan = document.createElement('span');
	block.appendChild(inSpan);

	var result = document.createElement('div')

	var input = document.createElement('input');
	input.classList.add('input-part')
	input.type = "text";
	input.onkeydown = function(e) {
		if (e.which === 9 || e.which == 13) {
			e.preventDefault();

			var input = e.target;
			var next = null;
			if (e.shiftKey) {
				var next = input.previousElementSibling;
				if (next === null) {
					return;
				}
			} else {
				var next = input.nextElementSibling;
				if (next === null) {
					if (input.value === '') {
						return;
					}
					next = document.createElement('span');
					inSpan.appendChild(next);
				}
			}
			var replacement = document.createElement('span');
			replacement.classList.add('input-part');
			replacement.innerText = input.value;
			inSpan.replaceChild(replacement, input);
			input.value = next.innerText;
			inSpan.replaceChild(input, next);
			input.focus()
		}

		if (e.which === 13) {
			var parts = inSpan.children[0].innerText.split(' ');
			for (var i = 1; i < inSpan.children.length-1; i++) {
				parts.push(inSpan.children[i].innerText);
			}
			run(parts, result);
			newBlock();
		}
	}
	inSpan.appendChild(input);

	result.classList.add('result');
	result.id = 'result' + n;
	result.innerText = 'Result';
	block.appendChild(result);

	document.body.appendChild(block);

	input.focus();

	allBlocks.push(block);
}
window.onload = newBlock;
	</script>
</head>
<body>
</body>
</html>